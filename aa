 if (Response.Headers.AllKeys.Contains("Set-Cookie"))
            {
                string[] cookies = Response.Headers.Get("Set-Cookie").Split(',');
                Response.Headers.Remove("Set-Cookie");

                string cookiePath = String.Join("", Request.Url.Segments, 0, Request.Url.Segments.Length - 1);

                foreach (string cookie in cookies)
                {
                    string newCookie = cookie;
                    if (newCookie.IndexOf("Domain", StringComparison.CurrentCultureIgnoreCase) == -1)
                        newCookie += "; Domain=" + Request.Url.Host;

                    if (newCookie.IndexOf("Path", StringComparison.CurrentCultureIgnoreCase) == -1)
                        newCookie += "; Path=" + cookiePath;
                    else if (Regex.IsMatch(newCookie, @"\b[Pp]ath=/;?\B"))
                        newCookie = Regex.Replace(newCookie, @"\b[Pp]ath=/;?\B", "Path=" + cookiePath + (newCookie.IndexOf("Path=/;", StringComparison.CurrentCultureIgnoreCase) > -1? ";" : ""));

                    if (newCookie.IndexOf("SameSite", StringComparison.CurrentCultureIgnoreCase) == -1)
                        newCookie += "; SameSite=Lax";

                    if (Request.IsSecureConnection && newCookie.IndexOf("Secure", StringComparison.CurrentCultureIgnoreCase) == -1)
                        newCookie += "; Secure";
                    
                    Response.AppendHeader("Set-Cookie", newCookie);
                }
            }
        }
